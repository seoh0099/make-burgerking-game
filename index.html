<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” MAKEBURGERKING í›ˆë ¨ ê²Œì„</title>
    <style>
        body {
            font-family: 'Malgun Gothic', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 750px;
            box-sizing: border-box;
            position: relative;
        }
        h1 {
            color: #d9534f;
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8em;
        }
        #order-display {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .prompt-area {
            margin-bottom: 20px;
        }
        #prompt-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 2px solid #337ab7;
            padding-bottom: 5px;
        }
        #prompt {
            font-size: 1.1em;
            font-weight: bold;
            color: #337ab7;
        }
        #hint-button {
            padding: 8px 12px;
            background-color: #f0ad4e;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.1s;
        }
        #hint-button:hover:not(:disabled) {
            background-color: #eb9334;
        }
        #hint-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* íŒíŠ¸ í‘œì‹œ ì˜ì—­ */
        #hint-display {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.95);
            border: 2px solid #f0ad4e;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 101;
            display: none;
            width: 250px;
        }
        #hint-display h4 {
            margin-top: 0;
            color: #f0ad4e;
            border-bottom: 1px solid #f0ad4e;
            padding-bottom: 5px;
        }
        #hint-list {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 0.95em;
        }
        #hint-list li {
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .choices-section {
            margin-bottom: 20px;
        }
        .choices-section h3 {
            color: #555;
            font-size: 1em;
            margin-bottom: 8px;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 3px;
        }
        .choices-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        /* ê¸°ë³¸ ë²„íŠ¼ í¬ê¸°: 4ì—´ ë°°ì¹˜ (íŒ¨í‹°, ë²ˆ, ê¸°íƒ€ ì†ì¬ë£Œ) */
        .choices-buttons .choice-button {
            padding: 12px 15px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            flex-grow: 1;
            min-width: 80px;
            max-width: calc(25% - 6px); /* 4 columns layout */
            box-sizing: border-box;
            transition: background-color 0.1s, transform 0.1s;
        }

        /* ì†ŒìŠ¤ ë²„íŠ¼ í¬ê¸°: 3ì—´ ë°°ì¹˜ (ì‚¬ìš©ì ìš”ì²­ì— ë§ì¶¤) */
        .choices-buttons.fixed-3-col .choice-button {
            max-width: calc(33.333% - 6px); /* 3 columns layout */
        }

        .choice-button.item { background-color: #337ab7; }
        .choice-button.patty { background-color: #d9534f; }
        .choice-button.bun { background-color: #f0ad4e; }
        .choice-button.sauce { background-color: #5cb85c; }
        .choice-button.wrap { background-color: #f0ad4e; }
        
        .choice-button:hover:not(:disabled) {
            filter: brightness(1.2);
        }
        .choice-button:active:not(:disabled) {
            transform: scale(0.98);
        }
        .choice-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .input-group {
            display: flex;
            margin-top: 10px;
        }
        #text-input {
            flex-grow: 1;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px 0 0 5px;
            font-size: 1em;
        }
        #text-submit {
            padding: 10px 15px;
            background-color: #d9534f;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 0 5px 5px 0;
            font-size: 1em;
        }

        #feedback {
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            min-height: 20px;
            margin-top: 15px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        #start-new-game-button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        /* ì„ íƒ í•­ëª© ì´ë ¥ í‘œì‹œ */
        #history-display {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 2px dashed #ccc;
        }
        #history-display h2 {
            font-size: 1.2em;
            color: #4CAF50;
            margin-bottom: 10px;
            text-align: center;
        }
        #selected-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px;
            background-color: #e8f5e9;
            border-radius: 8px;
        }
        .history-item {
            background-color: #ffffff;
            border: 1px solid #a5d6a7;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9em;
            color: #1b5e20;
        }

        /* X ì—ëŸ¬ í‘œì‹œ ì˜¤ë²„ë ˆì´ */
        #error-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            pointer-events: none;
        }
        #error-x {
            font-size: 15vw;
            color: red;
            font-weight: bolder;
            opacity: 0;
            transition: opacity 0.1s;
        }
        .show-x #error-x {
            opacity: 1;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ” MAKEBURGERKING í›ˆë ¨ ê²Œì„</h1>
    
    <div id="hint-display">
        <h4>ë‹¤ìŒ ìˆœì„œ íŒíŠ¸ (3ì´ˆ í›„ ì‚¬ë¼ì§)</h4>
        <ul id="hint-list"></ul>
    </div>

    <div id="order-display"></div>

    <div class="prompt-area">
        <div id="prompt-bar">
            <div id="prompt"></div>
            <button id="hint-button" style="display:none;" disabled>íŒíŠ¸ ë³´ê¸° (3ì´ˆ)</button>
        </div>
        
        <div id="choices-container">
            <div id="wrap-choices" class="choices-section" style="display:none;">
                <div class="choices-buttons" data-type="wrap"></div>
            </div>
            
            <div id="text-input-area" class="choices-section" style="display:none;">
                <div class="input-group">
                    <input type="text" id="text-input" placeholder="ê¸€ì”¨ë¥¼ ì…ë ¥í•˜ê³  í™•ì¸ì„ ëˆ„ë¥´ì„¸ìš”" autocomplete="off" maxlength="10">
                    <button id="text-submit">í™•ì¸</button>
                </div>
            </div>

            <div id="ingredient-choices" class="choices-section" style="display:none;">
                
                <h3>ğŸ ë²ˆ ì¢…ë¥˜</h3>
                <div id="bun-choices" class="choices-buttons" data-type="bun"></div> <h3>ğŸ¥© íŒ¨í‹°</h3>
                <div id="patty-choices" class="choices-buttons" data-type="patty"></div> 

                <h3>ğŸ¥« ì†ŒìŠ¤ & ë“œë ˆì‹±</h3>
                <div id="sauce-choices" class="choices-buttons fixed-3-col" data-type="sauce"></div>
                
                <h3>ğŸ¥’ ê¸°íƒ€ ì†ì¬ë£Œ</h3>
                <div id="item-choices" class="choices-buttons" data-type="item"></div>
            </div>
        </div>

        <div id="feedback"></div>
        
        <button id="start-new-game-button" style="display:none;">ìƒˆ ì£¼ë¬¸ ë°›ê¸°</button>
    </div>
    
    <div id="error-overlay">
        <span id="error-x">âŒ</span>
    </div>

    <div id="history-display">
        <h2>âœ… ë‚´ê°€ ë§Œë“  ë²„ê±° ìˆœì„œ</h2>
        <div id="selected-list">ì„ íƒí•œ í•­ëª©ì´ ì—¬ê¸°ì— ìˆœì„œëŒ€ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>
    </div>
</div>

<script>
    // --- 1. ë°ì´í„° ì •ì˜ ---

    const WRAP_CHOICES = [
        "ì™€í¼ë©", "ì™€ì¹˜ë©", "í†µìƒˆìš°ë©", "ì™€ì£¼ë©", "ì™€ì¹˜ì£¼ë©", "í¬í´ë©", "ìŠ¤ëª°ë©", "ì¹˜í‚¨í‚¹ë©", "í¬ë¦¬ìŠ¤í¼ë©", "ìŠˆë¦¼í”„ë©", "ì˜¤í”ˆë©", "ë§¥ì‹œë©ˆë©"
    ].filter((v, i, a) => a.indexOf(v) === i);

    const TEXT_CHOICES = ['-', 'B', 'GB', 'M', 'Q', 'S', 'C', 'BLT', 'ì¹˜í‚¨', 'CM', 'T', 'DY', 'HY', 'GT', '1', '2', '3', '4', 'BB', 'BS', 'BQ', 'Y', 'ë¹„í”„', 'í†µìƒˆìš°', 'ë²„ê±°ë²ˆ'];

    // --------------------------------------------------------
    // ** ì‚¬ìš©ì ìš”ì²­ ë°˜ì˜: ì†ŒìŠ¤/íŒ¨í‹°/ë²ˆ ëª©ë¡ ìˆœì„œ ë° ë¶„ë¦¬ **
    // --------------------------------------------------------
    
    // ì†ŒìŠ¤ ë° ë“œë ˆì‹± (SAUCE_CHOICES) - ê³ ì • 3ì—´ ë°°ì¹˜ë¥¼ ìœ„í•´ ìˆœì„œ ìœ ì§€
    const SAUCE_CHOICES = [
        // 1ì—´
        "íŠ¸ëŸ¬í”Œì†ŒìŠ¤", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ", "ë””ì•„ë¸”ë¡œì†ŒìŠ¤", 
        // 2ì—´
        "ì–‘ë…ì†ŒìŠ¤", "ë¶ˆê³ ê¸°ì†ŒìŠ¤", "íƒ€ë¥´íƒ€ë¥´", 
        // 3ì—´
        "ìŠ¤í…Œì´í¬ì†ŒìŠ¤", "ìŠ¤íŒŒì´ì‹œí† ë§ˆí† ì†ŒìŠ¤", "ì¼€ì°¹", 
        // 4ì—´
        "ë©”ì´í”Œì†ŒìŠ¤", "ë¶ˆë‹­ì†ŒìŠ¤", "í•«ë§ˆìš”ì†ŒìŠ¤",
        "ë§ˆìš”ë„¤ì¦ˆ", "ì¹˜ì¦ˆì†ŒìŠ¤" // ê¸°ì¡´ ë ˆì‹œí”¼ êµ¬í˜„ì„ ìœ„í•´ ì¶”ê°€ (5ì—´ë¡œ ê°„ì£¼)
    ].filter((v, i, a) => a.indexOf(v) === i); 

    // íŒ¨í‹° ëª©ë¡ (PATTY_CHOICES)
    const PATTY_CHOICES = [
        "ì™€í¼íŒ¨í‹°", "í‚¹ì¹˜í‚¨íŒ¨í‹°", "ë²„ê±°íŒ¨í‹°", "ë§ˆì¼ë“œê°€ìŠ´ì‚´íŒ¨í‹°", "ìŠ¤íŒŒì´ì‹œí™€ì¹˜í‚¨", 
        "í¬ë¦¬ìŠ¤í¼ í…ë”", "ìƒˆìš°íŒ¨í‹°", "150íŒ¨í‹°", "ì—ê·¸íŒ¨í‹°"
    ].filter((v, i, a) => a.indexOf(v) === i); 
    
    // ë²ˆ ëª©ë¡ (BUN_CHOICES) - ìƒˆë¡œ ë¶„ë¦¬
    const BUN_CHOICES = [
        "í", "ì™€í¼ë²ˆ", "ë²„ê±°ë²ˆ", "ë˜ë ì•„", "ë¸Œë¦¬ì˜¤ìŠˆë²ˆ", "ë² ì´ë¹„ë²ˆ"
    ].filter((v, i, a) => a.indexOf(v) === i);

    // ê¸°íƒ€ ì†ì¬ë£Œ (ITEM_ONLY_CHOICES) - ë²ˆ ì œì™¸
    const ITEM_ONLY_CHOICES = [
        "ì–‘ìƒì¶”", "í† ë§ˆí† ", "ì–‘íŒŒ", "í”¼í´", "í›„ë ˆì‹œí”¼í´", "ê°ˆë¦­ì¹©", "êµ¬ìš´ë²„ì„¯", "êµ¬ìš´ë§ˆëŠ˜", 
        "ì¹˜ì¦ˆ", "ëª¬í„°ë ˆì´ì­ì¹˜ì¦ˆ", "ìŠˆë ˆë”", "ë² ì´ì»¨", "ì†”íŠ¸í˜í¼", "ìƒˆìš°"
    ].filter((v, i, a) => a.indexOf(v) === i); 

    // --------------------------------------------------------
    
    // êµ¬ì¡°: [ë©ì§€, ë©ì§€ ê¸€ì”¨, ì¬ë£Œ1:ê°œìˆ˜, ì¬ë£Œ2:ê°œìˆ˜, ...]
    const RECIPES = {
        "ì™€í¼": ["ì™€í¼ë©", "-", "í:1", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "í”¼í´:4", "ì¼€ì°¹:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ì™€í¼ë²ˆ:1"],
        "ì¹˜ì¦ˆì™€í¼": ["ì™€ì¹˜ë©", "-", "í:1", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ì¹˜ì¦ˆ:2", "í”¼í´:4", "ì¼€ì°¹:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ì™€í¼ë²ˆ:1"],
        "ì½°íŠ¸ë¡œì¹˜ì¦ˆ ì™€í¼": ["ì™€í¼ë©", "-", "í:1", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ì¹˜ì¦ˆ:2", "ìŠˆë ˆë”:1", "ì¼€ì°¹:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ì™€í¼ë²ˆ:1"],
        "í†µìƒˆìš° ì™€í¼": ["í†µìƒˆìš°ë©", "-", "í:1", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ìƒˆìš°:4", "ìŠ¤íŒŒì´ì‹œí† ë§ˆí† ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ì™€í¼ë²ˆ:1"],
        "ë¶ˆê³ ê¸° ì™€í¼": ["ì™€í¼ë©", "B", "í:1", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "í”¼í´:4", "ë¶ˆê³ ê¸°ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ì™€í¼ë²ˆ:1"],
        "ê°ˆë¦­ë¶ˆê³ ê¸° ì™€í¼": ["ì™€í¼ë©", "GB", "í:1", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ê°ˆë¦­ì¹©:1", "ë¶ˆê³ ê¸°ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ì™€í¼ë²ˆ:1"],
        "ëª¬ìŠ¤í„° ì™€í¼": ["ì™€í¼ë©", "M", "í:1", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ì¹˜ì¦ˆ:2", "ë² ì´ì»¨:2", "í‚¹ì¹˜í‚¨íŒ¨í‹°:1", "ë””ì•„ë¸”ë¡œì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1"],
        "ì™€í¼ì£¼ë‹ˆì–´": ["ì™€ì£¼ë©", "-", "í:1", "ë²„ê±°íŒ¨í‹°:1", "í”¼í´:4", "ì¼€ì°¹:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "ì¹˜ì¦ˆì™€í¼ì£¼ë‹ˆì–´": ["ì™€ì¹˜ì£¼ë©", "-", "í:1", "ë²„ê±°íŒ¨í‹°:1", "ì¹˜ì¦ˆ:2", "í”¼í´:4", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "ì½°íŠ¸ë¡œì¹˜ì¦ˆ ì™€í¼ì£¼ë‹ˆì–´": ["ì™€ì¹˜ì£¼ë©", "Q", "í:1", "ì¹˜ì¦ˆì†ŒìŠ¤:1", "ë²„ê±°íŒ¨í‹°:1", "ì¹˜ì¦ˆ:1", "ìŠˆë ˆë”:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "í†µìƒˆìš° ì™€í¼ì£¼ë‹ˆì–´": ["ì™€ì£¼ë©", "S", "í:1", "ë²„ê±°íŒ¨í‹°:1", "ìƒˆìš°:2", "ìŠ¤íŒŒì´ì‹œí† ë§ˆí† ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "ë¶ˆê³ ê¸° ì™€í¼ì£¼ë‹ˆì–´": ["ì™€ì£¼ë©", "B", "í:1", "ë²„ê±°íŒ¨í‹°:1", "í”¼í´:2", "ë¶ˆê³ ê¸°ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "ëª¬ìŠ¤í„° ì£¼ë‹ˆì–´": ["ì™€ì£¼ë©", "M", "í:1", "ë²„ê±°íŒ¨í‹°:1", "ì¹˜ì¦ˆ:1", "ë””ì•„ë¸”ë¡œì†ŒìŠ¤:1", "í‚¹ì¹˜í‚¨íŒ¨í‹°:1", "ë¶ˆê³ ê¸°ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "ì¹˜í‚¨ì¹˜ì¦ˆë§ˆìš”ë²„ê±°": ["í¬í´ë©", "CM", "í:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "í‚¹ì¹˜í‚¨íŒ¨í‹°:1", "ì¹˜ì¦ˆ:1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "ì¹˜ì¦ˆë²„ê±°": ["ìŠ¤ëª°ë©", "C", "í:1", "ë²„ê±°íŒ¨í‹°:1", "ì¹˜ì¦ˆ:1", "í”¼í´:2", "ì¼€ì°¹:1", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "ë²„ê±°ë²ˆ:1"],
        "ë¹„í”„ ë¶ˆê³ ê¸°ë²„ê±°": ["ìŠ¤ëª°ë©", "B", "í:1", "ë²„ê±°íŒ¨í‹°:1", "ë¶ˆê³ ê¸°ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "ë”ë¸”ë¹„í”„ ë¶ˆê³ ê¸°ë²„ê±°": ["ìŠ¤ëª°ë©", "B", "í:1", "ë²„ê±°íŒ¨í‹°:1", "ì¹˜ì¦ˆ:1", "ë²„ê±°íŒ¨í‹°:1", "ë¶ˆê³ ê¸°ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "ì¹˜í‚¨í‚¹": ["ì¹˜í‚¨í‚¹ë©", "-", "í:1", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "í”¼í´:4", "ìŠ¤íŒŒì´ì‹œí™€ì¹˜í‚¨:1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë¸Œë¦¬ì˜¤ìŠˆë²ˆ:1"],
        "ì¹˜í‚¨í‚¹BLT": ["ì¹˜í‚¨í‚¹ë©", "BLT", "í:1", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "í”¼í´:4", "ìŠ¤íŒŒì´ì‹œí™€ì¹˜í‚¨:1", "ë² ì´ì»¨:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë¸Œë¦¬ì˜¤ìŠˆë²ˆ:1"],
        "ì¹˜í‚¨ë²„ê±°": ["í¬í´ë©", "ì¹˜í‚¨", "í:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "í”¼í´:4", "í‚¹ì¹˜í‚¨íŒ¨í‹°:1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "í¬ë¦¬ìŠ¤í¼ í´ë˜ì‹": ["í¬í´ë©", "-", "í:1", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "í›„ë ˆì‹œí”¼í´:4", "ë§ˆì¼ë“œê°€ìŠ´ì‚´íŒ¨í‹°:1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "í¬ë¦¬ìŠ¤í¼ í´ë˜ì‹ BLT": ["í¬í´ë©", "BLT", "í:1", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "í›„ë ˆì‹œí”¼í´:4", "ë§ˆì¼ë“œê°€ìŠ´ì‚´íŒ¨í‹°:1", "ë² ì´ì»¨:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "í¬ë¦¬ìŠ¤í¼ ë©": ["í¬ë¦¬ìŠ¤í¼ë©", "-", "ë˜ë ì•„:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ì–‘ìƒì¶”:1", "í›„ë ˆì‹œí”¼í´:2", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "í¬ë¦¬ìŠ¤í¼ í…ë”:1"],
        "í¬ë¦¬ìŠ¤í¼ ë© ë¶ˆë‹­ì¹˜í‚¨": ["í¬ë¦¬ìŠ¤í¼ë©", "B", "ë˜ë ì•„:1", "ë¶ˆë‹­ì†ŒìŠ¤:1", "ì–‘ìƒì¶”:1", "ë¶ˆë‹­ì†ŒìŠ¤:1", "í¬ë¦¬ìŠ¤í¼ í…ë”:1"],
        "í¬ë¦¬ìŠ¤í¼ ë© ì–‘ë…ì¹˜í‚¨": ["í¬ë¦¬ìŠ¤í¼ë©", "Y", "ë˜ë ì•„:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ì–‘ìƒì¶”:1", "ì–‘ë…ì†ŒìŠ¤:1", "í¬ë¦¬ìŠ¤í¼ í…ë”:1"],
        "í¬ë¦¬ìŠ¤í¼ ë¶ˆë‹­ì¹˜í‚¨": ["í¬í´ë©", "B", "í:1", "ë§ˆì¼ë“œê°€ìŠ´ì‚´íŒ¨í‹°:1", "ë¶ˆë‹­ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "ë¶ˆë‹­ì†ŒìŠ¤:1", "ë²„ê±°ë²ˆ:1"],
        "í¬ë¦¬ìŠ¤í¼ ì–‘ë…ì¹˜í‚¨": ["í¬í´ë©", "Y", "í:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ì–‘ë…ì†ŒìŠ¤:1", "ë§ˆì¼ë“œê°€ìŠ´ì‚´íŒ¨í‹°:1", "ì–‘ë…ì†ŒìŠ¤:1", "ê°ˆë¦­ì¹©:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "ìŠˆë¦¼í”„ ë²„ê±°": ["ìŠˆë¦¼í”„ë©", "ë²„ê±°ë²ˆ", "í:1", "ìƒˆìš°íŒ¨í‹°:1", "íƒ€ë¥´íƒ€ë¥´:1", "ì–‘ìƒì¶”:1", "íƒ€ë¥´íƒ€ë¥´:1", "ë²„ê±°ë²ˆ:1"],
        "í†µìƒˆìš° ìŠˆë¦¼í”„ ë²„ê±°": ["ìŠˆë¦¼í”„ë©", "í†µìƒˆìš°", "í:1", "ìƒˆìš°íŒ¨í‹°:1", "ìƒˆìš°:2", "ìŠ¤íŒŒì´ì‹œí† ë§ˆí† ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "íƒ€ë¥´íƒ€ë¥´:1", "ë²„ê±°ë²ˆ:1"],
        "ë¹„í”„&ìŠˆë¦¼í”„ ë²„ê±°": ["ìŠˆë¦¼í”„ë©", "ë¹„í”„", "í:1", "ë²„ê±°íŒ¨í‹°:1", "ìƒˆìš°íŒ¨í‹°:1", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "íƒ€ë¥´íƒ€ë¥´:1", "ë²„ê±°ë²ˆ:1"],
        "ë² ì´ë¹„ ì½°íŠ¸ë¡œ": ["ìŠ¤ëª°ë©", "BQ", "í:1", "ì¹˜ì¦ˆì†ŒìŠ¤:1", "ë²„ê±°íŒ¨í‹°:1", "ì¹˜ì¦ˆ:1", "ìŠˆë ˆë”:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë²„ê±°ë²ˆ:1"],
        "ë² ì´ë¹„ í†µìƒˆìš°": ["ìŠ¤ëª°ë©", "BS", "í:1", "ë²„ê±°íŒ¨í‹°:1", "ìƒˆìš°:2", "ìŠ¤íŒŒì´ì‹œí† ë§ˆí† ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë² ì´ë¹„ë²ˆ:1"],
        "ë² ì´ë¹„ ë¶ˆê³ ê¸°": ["ìŠ¤ëª°ë©", "BB", "í:1", "ë²„ê±°íŒ¨í‹°:1", "í”¼í´:2", "ë¶ˆê³ ê¸°ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë² ì´ë¹„ë²ˆ:1"],
        "íŠ¸ëŸ¬í”Œ ë¨¸ì‰¬ë£¸ ì™€í¼": ["ì™€í¼ë©", "T", "í:1", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ë² ì´ì»¨:2", "êµ¬ìš´ë²„ì„¯:1", "íŠ¸ëŸ¬í”Œì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "íŠ¸ëŸ¬í”Œì†ŒìŠ¤:1", "ì™€í¼ë²ˆ:1"],
        "ë”¥ íŠ¸ëŸ¬í”Œ ë¨¸ì‰¬ë£¸ ë”ë¸”": ["ì™€í¼ë©", "DY", "í:1", "íŠ¸ëŸ¬í”Œì†ŒìŠ¤:1", "ì™€í¼íŒ¨í‹°:1", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "êµ¬ìš´ë²„ì„¯:1", "íŠ¸ëŸ¬í”Œì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "íŠ¸ëŸ¬í”Œì†ŒìŠ¤:1", "ì™€í¼ë²ˆ:1"],
        "í•« íŠ¸ëŸ¬í”Œ ë¨¸ì‰¬ë£¸ì™€í¼": ["ì™€í¼ë©", "HY", "í:1", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ë² ì´ì»¨:2", "êµ¬ìš´ë²„ì„¯:1", "í•«ë§ˆìš”ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "íŠ¸ëŸ¬í”Œì†ŒìŠ¤:1", "ì™€í¼ë²ˆ:1"],
        "ê³¨ë“  ì—ê·¸ íŠ¸ëŸ¬í”Œ": ["ì™€í¼ë©", "GT", "í:1", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ëª¬í„°ë ˆì´ì­ì¹˜ì¦ˆ:1", "ì—ê·¸íŒ¨í‹°:1", "êµ¬ìš´ë²„ì„¯:1", "íŠ¸ëŸ¬í”Œì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "íŠ¸ëŸ¬í”Œì†ŒìŠ¤:1", "ë¸Œë¦¬ì˜¤ìŠˆë²ˆ:1"],
        "ë‰´ìš• ìŠ¤í…Œì´í¬": ["ì˜¤í”ˆë©", "1", "í:1", "ëª¬í„°ë ˆì´ì­ì¹˜ì¦ˆ:1", "150íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ì¹˜ì¦ˆ:1", "ë² ì´ì»¨:2", "ìŠˆë ˆë”:1", "ìŠ¤í…Œì´í¬ì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "ìŠ¤í…Œì´í¬ì†ŒìŠ¤:1", "ë¸Œë¦¬ì˜¤ìŠˆë²ˆ:1"],
        "ë©”ì´í”Œê°ˆë¦­": ["ì˜¤í”ˆë©", "2", "í:1", "ëª¬í„°ë ˆì´ì­ì¹˜ì¦ˆ:1", "150íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ë² ì´ì»¨:2", "êµ¬ìš´ë§ˆëŠ˜:10", "ë©”ì´í”Œì†ŒìŠ¤:1", "ì–‘íŒŒ:1", "í† ë§ˆí† :1", "ì–‘ìƒì¶”:1", "ë§ˆìš”ë„¤ì¦ˆ:1", "ë¸Œë¦¬ì˜¤ìŠˆë²ˆ:1"],
        "ë”ì˜¤ì¹˜ë§¥ì‹œë©ˆ2": ["ë§¥ì‹œë©ˆë©", "2", "í:1", "ì™€í¼íŒ¨í‹°:1", "ì¹˜ì¦ˆ:2", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ì¹˜ì¦ˆ:2", "í”¼í´:4", "ì¼€ì°¹:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "ì™€í¼ë²ˆ:1"],
        "ë”ì˜¤ì¹˜ë§¥ì‹œë©ˆ3": ["ë§¥ì‹œë©ˆë©", "3", "í:1", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "ì™€í¼íŒ¨í‹°:1", "ì¹˜ì¦ˆ:2", "ì™€í¼íŒ¨í‹°:1", "ì¹˜ì¦ˆ:2", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ì¹˜ì¦ˆ:2", "í”¼í´:4", "ì¼€ì°¹:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "ì™€í¼ë²ˆ:1"],
        "ë§¥ì‹œë©ˆì›íŒŒìš´ë“œ": ["ë§¥ì‹œë©ˆë©", "4", "í:1", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "ì™€í¼íŒ¨í‹°:1", "ì¹˜ì¦ˆ:2", "ì™€í¼íŒ¨í‹°:1", "ì¹˜ì¦ˆ:2", "ì™€í¼íŒ¨í‹°:1", "ì¹˜ì¦ˆ:2", "ì™€í¼íŒ¨í‹°:1", "ì†”íŠ¸í˜í¼:1", "ì¹˜ì¦ˆ:2", "í”¼í´:4", "ì¼€ì°¹:1", "ì–‘íŒŒ:1", "ì–‘ìƒì¶”:1", "ìŠ¤ëª¨í‚¤ë¨¸ìŠ¤íƒ€ë“œ:1", "ì™€í¼ë²ˆ:1"],
    };


    // --- 2. ê²Œì„ ìƒíƒœ ê´€ë¦¬ ë³€ìˆ˜ ---
    let currentRecipeName = '';
    let currentRecipeData = [];
    let currentStep = 0; // 0: ë©ì§€, 1: ê¸€ì”¨, 2: ì¬ë£Œ (íë¶€í„°)
    let currentIngredientIndex = 0; // ë ˆì‹œí”¼ ë°ì´í„°ì˜ ì¬ë£Œ ì‹œì‘ ì¸ë±ìŠ¤ (íë¶€í„°: 2)
    let isGameRunning = false;
    let hintTimeout = null; // íŒíŠ¸ íƒ€ì´ë¨¸ ê´€ë¦¬
    let selectedHistory = []; // ì„ íƒëœ í•­ëª© ì´ë ¥

    // --- 3. DOM ìš”ì†Œ ---
    const orderDisplay = document.getElementById('order-display');
    const promptElement = document.getElementById('prompt');
    const wrapChoicesDiv = document.querySelector('#wrap-choices .choices-buttons');
    const textInputArea = document.getElementById('text-input-area');
    const textInput = document.getElementById('text-input');
    const textSubmit = document.getElementById('text-submit');
    const bunChoicesDiv = document.getElementById('bun-choices'); // ë²ˆ DOM
    const pattyChoicesDiv = document.getElementById('patty-choices'); // íŒ¨í‹° DOM
    const itemChoicesDiv = document.getElementById('item-choices'); // ê¸°íƒ€ ì†ì¬ë£Œ DOM
    const sauceChoicesDiv = document.getElementById('sauce-choices'); // ì†ŒìŠ¤ DOM
    const feedbackElement = document.getElementById('feedback');
    const startNewGameButton = document.getElementById('start-new-game-button');
    const errorOverlay = document.getElementById('error-overlay');
    const hintButton = document.getElementById('hint-button');
    const hintDisplay = document.getElementById('hint-display');
    const hintList = document.getElementById('hint-list');
    const selectedListDisplay = document.getElementById('selected-list');

    // --- 4. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---

    function showFeedback(message, isCorrect) {
        feedbackElement.textContent = message;
        feedbackElement.className = isCorrect ? 'success' : 'error';
    }

    function hideFeedback() {
        feedbackElement.textContent = '';
        feedbackElement.className = '';
    }

    function updateHistoryDisplay() {
        selectedListDisplay.innerHTML = '';
        if (selectedHistory.length === 0) {
            selectedListDisplay.textContent = 'ì„ íƒí•œ í•­ëª©ì´ ì—¬ê¸°ì— ìˆœì„œëŒ€ë¡œ í‘œì‹œë©ë‹ˆë‹¤.';
            return;
        }

        selectedHistory.forEach((item) => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.innerHTML = item;
            selectedListDisplay.appendChild(historyItem);
        });
    }

    /**
     * ë²„íŠ¼ì„ ìƒì„±í•˜ê³  í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤. ì†ŒìŠ¤ì²˜ëŸ¼ isFixedOrderê°€ trueë©´ ìˆœì„œ ê³ ì •.
     */
    function createButtons(choices, container, className, isFixedOrder = false) {
        container.innerHTML = '';
        
        // isFixedOrderê°€ trueì¼ ê²½ìš° ìˆœì„œ ê³ ì •, ì•„ë‹ˆë©´ ëœë¤ ë°°ì—´ (í›ˆë ¨ìš©)
        const finalChoices = isFixedOrder ? choices.slice() : choices.slice().sort(() => Math.random() - 0.5);
        
        // CSS í´ë˜ìŠ¤ ì ìš© (ì†ŒìŠ¤ì—ë§Œ fixed-3-col ì ìš©ë¨)
        if (isFixedOrder) {
            container.classList.add('fixed-3-col'); 
        } else {
            container.classList.remove('fixed-3-col');
        }

        finalChoices.forEach(choice => {
            const button = document.createElement('button');
            button.className = `choice-button ${className}`;
            button.textContent = choice;
            button.setAttribute('data-value', choice);
            button.addEventListener('click', () => processClick(choice));
            container.appendChild(button);
        });
    }

    /**
     * ëª¨ë“  ë²„íŠ¼ì„ ìƒì„±í•˜ê³  í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
     */
    function generateButtons() {
        // ë©ì§€ (ëœë¤)
        createButtons(WRAP_CHOICES, wrapChoicesDiv, 'wrap');
        // ë²ˆ (ëœë¤)
        createButtons(BUN_CHOICES, bunChoicesDiv, 'bun');
        // íŒ¨í‹° (ëœë¤)
        createButtons(PATTY_CHOICES, pattyChoicesDiv, 'patty');
        // ê¸°íƒ€ ì†ì¬ë£Œ (ëœë¤)
        createButtons(ITEM_ONLY_CHOICES, itemChoicesDiv, 'item');
        // ì†ŒìŠ¤ (ìˆœì„œ ê³ ì • & 3ì—´ ë°°ì¹˜)
        createButtons(SAUCE_CHOICES, sauceChoicesDiv, 'sauce', true); 
    }

    function showCurrentStepUI(step) {
        document.querySelectorAll('.choices-section').forEach(el => el.style.display = 'none');
        startNewGameButton.style.display = 'none';
        hintButton.style.display = 'none';
        hintButton.disabled = true;

        if (step === 0) {
            document.getElementById('wrap-choices').style.display = 'block';
            promptElement.textContent = "ë©ì§€ëŠ” ë¬´ì—‡ì…ë‹ˆê¹Œ?";
        } else if (step === 1) {
            textInputArea.style.display = 'block';
            promptElement.textContent = "ë¬´ìŠ¨ ê¸€ì”¨ë¥¼ ì ì–´ì•¼ í•©ë‹ˆê¹Œ?";
            textInput.value = '';
            textInput.focus();
        } else if (step === 2) {
            document.getElementById('ingredient-choices').style.display = 'block';
            promptElement.textContent = "ì¬ë£ŒëŠ” ë¬´ì—‡ì…ë‹ˆê¹Œ?";
            hintButton.style.display = 'inline-block';
            hintButton.disabled = false;
        } else { // 3: Game Finished
            promptElement.innerHTML = `<strong>ğŸ‰ ${currentRecipeName} í¬ì¥ ì™„ë£Œ! ğŸ‰</strong>`;
            startNewGameButton.style.display = 'block';
            showFeedback("âœ¨ ì™„ë²½í•©ë‹ˆë‹¤! ëª¨ë“  ë‹¨ê³„ë¥¼ ì •í™•í•˜ê²Œ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤! âœ¨", true);
        }
    }
    
    function showHint() {
        if (currentStep !== 2 || !isGameRunning || hintButton.disabled) return;
        
        hintButton.disabled = true;

        hintList.innerHTML = '';
        
        const hintItems = currentRecipeData.slice(currentIngredientIndex, currentIngredientIndex + 5);

        if (hintItems.length === 0) {
            hintList.innerHTML = '<li>ë‚¨ì€ ì¬ë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
        } else {
            hintItems.forEach((item, index) => {
                const [name, count] = item.split(':');
                const listItem = document.createElement('li');
                listItem.textContent = `${currentIngredientIndex - 1 + index}. ${name} (${count}ê°œ)`; 
                hintList.appendChild(listItem);
            });
        }
        
        hintDisplay.style.display = 'block';

        clearTimeout(hintTimeout);
        hintTimeout = setTimeout(() => {
            hintDisplay.style.display = 'none';
            if (currentStep === 2) { 
                hintButton.disabled = false;
            }
        }, 3000); 
    }

    function triggerErrorAndRestart() {
        isGameRunning = false;
        errorOverlay.style.display = 'flex';
        errorOverlay.classList.add('show-x');
        
        showFeedback(`âŒ ì˜¤ë‹µ! ì¬ë£Œ ìˆœì„œë¥¼ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.`, false);
        
        hintDisplay.style.display = 'none';
        clearTimeout(hintTimeout);

        selectedHistory = selectedHistory.slice(0, 2); 
        currentStep = 2; 
        currentIngredientIndex = 2;
        
        setTimeout(() => {
            errorOverlay.classList.remove('show-x');
            errorOverlay.style.display = 'none';
            hideFeedback();
            isGameRunning = true;
            updateHistoryDisplay();
            nextStep(); 
        }, 1000); 
    }

    function processClick(userAnswer) {
        if (!isGameRunning) return;
        
        if (hintDisplay.style.display === 'block') {
            hintDisplay.style.display = 'none';
            clearTimeout(hintTimeout);
            hintButton.disabled = false;
        }
        
        hideFeedback();
        let correctItem = '';

        if (currentStep === 0) {
            // ë©ì§€ ë‹¨ê³„
            correctItem = currentRecipeData[0];
            if (userAnswer === correctItem) {
                currentStep = 1;
                selectedHistory.push(`ë©ì§€: ${correctItem}`);
                showFeedback(`âœ… ë©ì§€ ì •ë‹µ! (${correctItem})`, true);
                updateHistoryDisplay();
                setTimeout(nextStep, 500);
            } else {
                showFeedback(`âŒ ë©ì§€ ì˜¤ë‹µ! [${userAnswer}] ì„ íƒ. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.`, false);
            }

        } else if (currentStep === 2) {
            // ì¬ë£Œ ìˆœì„œ ë‹¨ê³„
            if (currentIngredientIndex >= currentRecipeData.length) {
                return;
            }

            const fullItem = currentRecipeData[currentIngredientIndex];
            correctItem = fullItem.split(':')[0]; 

            if (userAnswer === correctItem) {
                // ì •ë‹µ!
                const [name, count] = fullItem.split(':');
                selectedHistory.push(`ì¬ë£Œ: ${name} (${count}ê°œ)`);
                
                showFeedback(`âœ… ì •ë‹µ! (${currentIngredientIndex - 1}ë²ˆì§¸ ì¬ë£Œ: ${correctItem})`, true);
                currentIngredientIndex++;
                updateHistoryDisplay();
                
                if (currentIngredientIndex >= currentRecipeData.length) {
                    currentStep = 3;
                }
                
                document.querySelectorAll('.choice-button').forEach(btn => btn.disabled = true);
                
                setTimeout(nextStep, 500); 
            } else {
                // ì˜¤ë‹µ! ì¬ë£Œ ë‹¨ê³„ ì´ˆê¸°í™”
                triggerErrorAndRestart();
            }
        }
    }

    function processTextInput() {
        if (!isGameRunning) return;

        const userAnswer = textInput.value.trim().toUpperCase();
        const correctItem = currentRecipeData[1];
        
        if (currentStep !== 1) return;

        if (userAnswer === correctItem.toUpperCase()) {
            currentStep = 2;
            selectedHistory.push(`ê¸€ì”¨: ${correctItem}`);
            showFeedback(`âœ… ê¸€ì”¨ ì •ë‹µ! (${correctItem})`, true);
            updateHistoryDisplay();
            setTimeout(nextStep, 500);
        } else {
            showFeedback(`âŒ ê¸€ì”¨ ì˜¤ë‹µ! [${userAnswer}] ì…ë ¥. ì •ë‹µì€ [${correctItem}] ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”.`, false);
            textInput.value = '';
            textInput.focus();
        }
    }


    function nextStep() {
        hideFeedback();
        showCurrentStepUI(currentStep);
        
        // ì¬ë£Œ ë‹¨ê³„ì—ì„œë§Œ ë²„íŠ¼ í™œì„±í™”
        if (currentStep === 2) {
             document.querySelectorAll('.choice-button').forEach(btn => btn.disabled = false);
        } else {
             // ë©ì§€ ë‹¨ê³„ì—ì„œëŠ” ë©ì§€ ë²„íŠ¼ë§Œ í™œì„±í™”
             document.querySelectorAll('.choice-button').forEach(btn => btn.disabled = true);
             document.querySelectorAll('#wrap-choices .choice-button').forEach(btn => btn.disabled = false);
        }
    }

    function startGame() {
        const menuNames = Object.keys(RECIPES);
        currentRecipeName = menuNames[Math.floor(Math.random() * menuNames.length)];
        currentRecipeData = RECIPES[currentRecipeName];
        currentStep = 0; 
        currentIngredientIndex = 2;
        isGameRunning = true;
        selectedHistory = [];
        
        orderDisplay.textContent = `ğŸ“¢ ì£¼ë¬¸ì´ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤: ${currentRecipeName}`;
        textInput.value = '';
        hintDisplay.style.display = 'none';
        clearTimeout(hintTimeout);
        
        // ë²„íŠ¼ ë°°ì—´ì„ ì¬ëœë¤í™” ë° ìƒì„± (ì†ŒìŠ¤ ì œì™¸)
        generateButtons(); 
        updateHistoryDisplay();
        
        nextStep();
    }

    // --- 6. ì´ˆê¸° ì‹¤í–‰ ë° ì´ë²¤íŠ¸ ì—°ê²° ---
    document.addEventListener('DOMContentLoaded', () => {
        generateButtons();

        textSubmit.addEventListener('click', processTextInput);
        textInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                processTextInput();
            }
        });
        
        hintButton.addEventListener('click', showHint);
        startNewGameButton.addEventListener('click', startGame);

        startGame();
    });
</script>

</body>
</html>